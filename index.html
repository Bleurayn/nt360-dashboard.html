<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (your existing head content) ... -->
    <style>
        /* ... (your existing styles) ... */
        .error-message { color: #dc2626; text-align: center; margin: 20px; }
    </style>
</head>
<body>
    <div>© 2025 Cassandra Harrison/AvaBleu Design LTD Liability Company – Proprietary Platform • Public Demo Only</div>
    <script>
        console.log('%c NT360 — CONFIDENTIAL COMMERCIAL PLATFORM\n This is a public demonstration only. Core systems are closed-source and proprietary.', 'font-size:14px; color:#e11d48');
        console.log('%c NT360 RealTime Initialized – © 2025 Confidential Prototype', 'font-size:14px; color:#1e40af');
        console.log('- Real NCT API integration active');
        console.log('- Extend with backend for full fusion');
    </script>

    <!-- ... (your existing body content up to container) ... -->

    <div class="container">
        <!-- Key Metrics -->
        <div class="metrics">
            <!-- ... (unchanged) ... -->
        </div>

        <h2>Trial Analysis</h2>

        <script>
            let trials = [];
            let trialCount = 0;

            async function fetchTrials() {
                try {
                    // Fixed valid API URL
                    const response = await fetch('https://clinicaltrials.gov/api/v2/studies?query.cond=Oncology&recrs=a&phase=1,2,3&count=20&format=json');
                    if (!response.ok) throw new Error('API request failed');
                    const data = await response.json();
                    trials = data.studies || [];
                    trialCount = trials.length;
                    console.log('Fetched', trialCount, 'real oncology trials');
                } catch (error) {
                    console.error('API Error:', error);
                    document.getElementById('protocol-list').innerHTML = '<p class="error-message">Error loading trials from ClinicalTrials.gov. Please check your connection and try again.</p>';
                }
            }

            function updateDisplay() {
                const list = document.getElementById('protocol-list');
                list.innerHTML = '';
                if (trials.length === 0) {
                    list.innerHTML = '<p class="error-message">No trials loaded yet.</p>';
                    return;
                }

                trials.slice(0, 8).forEach(trial => {
                    const div = document.createElement('div');
                    div.className = 'protocol-item';

                    const protocol = trial.protocolSection || {};
                    const idModule = protocol.identificationModule || {};
                    const sponsorModule = protocol.sponsorCollaboratorsModule || {};
                    const designModule = protocol.designModule || {};

                    // Safe extraction with fallbacks
                    const nctId = idModule.nctId || 'NCT Unknown';
                    const title = idModule.briefTitle || 'Title N/A';
                    const sponsor = sponsorModule.leadSponsor?.name || 'Sponsor N/A';
                    
                    let phase = 'Phase Unknown';
                    if (designModule.phases && designModule.phases.length > 0) {
                        phase = designModule.phases.join(', '); // If phases array exists
                    } else if (designModule.designInfo?.interventionModel) {
                        phase = designModule.designInfo.interventionModel;
                    }

                    const patients = designModule.enrollmentInfo?.count || 'N/A';
                    const cost = `$${(Math.random() * 20 + 10).toFixed(1)}M`; // Mock cost

                    // Basic escaping for safety
                    function esc(str) { return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }

                    div.innerHTML = `
                        <div class="protocol-info">
                            <div class="protocol-id">${esc(nctId)}</div>
                            <div class="protocol-title">${esc(title)}</div>
                            <div class="protocol-details">${esc(sponsor)} • ${esc(phase)} • ${patients} patients • ${cost}</div>
                        </div>
                        <button class="analyze-btn" onclick="analyze('${esc(nctId)}')">Analyze</button>
                    `;
                    list.appendChild(div);
                });
            }

            function analyze(id) {
                const results = document.getElementById('analysis-results');
                results.style.display = 'block';
                document.getElementById('analyzed-id').textContent = id || 'Unknown';
                // ... (your existing simulation code) ...
            }

            // Init
            fetchTrials().then(updateDisplay);
            // ... (your existing intervals etc.) ...
        </script>

        <div id="protocol-list"></div>
        <!-- ... (rest of body) ... -->
    </div>
</body>
</html>
